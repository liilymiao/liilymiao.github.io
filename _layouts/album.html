---
layout: default
---

<!-- PhotoSwipe 样式 -->
<link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">

<article class="page">
  <h1>{{ page.title_en | default: page.title }}</h1>
  {% if page.content %}
    <div class="post-content">{{ content }}</div>
  {% endif %}

  <div class="album-grid">
    {% for p in page.photos %}
      {%- assign src   = p.src -%}
      {%- assign base  = src | replace:'/assets/img/albums/','/assets/thumbs/albums/' -%}

      {%- assign thumb = base
        | replace: '.JPG','-thumb.jpg'  | replace: '.JPEG','-thumb.jpg'
        | replace: '.jpg','-thumb.jpg'  | replace: '.jpeg','-thumb.jpg' -%}

      {%- assign large = base
        | replace: '.JPG','-large.jpg'  | replace: '.JPEG','-large.jpg'
        | replace: '.jpg','-large.jpg'  | replace: '.jpeg','-large.jpg' -%}

      {%- assign caption = p.caption | default: page.title -%}

      <figure class="album-item">
        <img
          src="{{ thumb | relative_url }}"
          data-full="{{ large | relative_url }}"
          alt="{{ caption }}"
          loading="lazy" decoding="async">
        {% if p.caption %}<figcaption>{{ p.caption }}</figcaption>{% endif %}
      </figure>
    {% endfor %}
  </div>
</article>

<!-- PhotoSwipe 脚本（ESM） -->
<script type="module">
  import PhotoSwipe from 'https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js';

  (function(){
    const grid = document.querySelector('.album-grid');
    if (!grid) return;

    function buildItems() {
      const imgs = Array.from(grid.querySelectorAll('.album-item img'));
      return imgs.map(img => {
        const full = img.getAttribute('data-full') || img.currentSrc || img.src;
        const w = img.naturalWidth  || 1600;
        const h = img.naturalHeight || 1067;
        return { src: full, width: w, height: h, alt: img.alt || '' };
      });
    }

    function openLightbox(clickedImg) {
      const imgs = Array.from(grid.querySelectorAll('.album-item img'));
      const items = buildItems();
      const curFull = clickedImg.getAttribute('data-full') || clickedImg.currentSrc || clickedImg.src;
      const idx = Math.max(0, items.findIndex(it => it.src === curFull));
      const pswp = new PhotoSwipe({
        index: idx,
        dataSource: items,
        bgOpacity: 0.95,
        wheelToZoom: true
      });
      pswp.init();
    }

    grid.addEventListener('click', (e) => {
      const img = e.target.closest('.album-item img');
      if (!img) return;
      e.preventDefault();
      openLightbox(img);
    });
  })();
</script>

<style>
  .album-grid{
    columns: 2;
    column-gap:16px;
    margin-top:10px;
  }
  @media (max-width:980px){ .album-grid{ columns:2; } }
  @media (max-width:640px){ .album-grid{ columns:1; } }

  .album-item{
    break-inside:avoid; -webkit-column-break-inside:avoid; margin:0 0 16px;
    background:var(--card-bg);
    border:var(--card-border);
    border-radius:10px; overflow:hidden;
    box-shadow:var(--card-shadow);
  }
  /* 关键：不设固定高，按原比例渲染缩略图 */
  .album-item img{
    display:block; width:100%; height:auto; cursor: zoom-in;
  }
  .album-item figcaption{
    padding:8px 10px;
    color:var(--muted);
    font-size:.92rem;
    background:var(--card-bg);
  }
</style>