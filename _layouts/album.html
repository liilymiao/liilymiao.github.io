---
layout: default
---

<!-- PhotoSwipe 样式 -->
<link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css">

<article class="page">
  <h1>{{ page.title_en | default: page.title }}</h1>
  {% if page.content %}
    <div class="post-content">{{ content }}</div>
  {% endif %}

  <div class="album-grid">
    {%- assign photos_desc = page.photos | reverse -%}  <!-- ✅ 倒序排列 -->
    {% for p in photos_desc %}
      {%- assign src   = p.src -%}
      {%- assign base  = src | replace:'/assets/img/albums/','/assets/thumbs/albums/' -%}

      {%- assign thumb = base
        | replace: '.JPG','-thumb.jpg'  | replace: '.JPEG','-thumb.jpg'
        | replace: '.jpg','-thumb.jpg'  | replace: '.jpeg','-thumb.jpg' -%}

      {%- assign large = base
        | replace: '.JPG','-large.jpg'  | replace: '.JPEG','-large.jpg'
        | replace: '.jpg','-large.jpg'  | replace: '.jpeg','-large.jpg' -%}

      {%- assign caption = p.caption | default: page.title -%}

      <figure class="album-item">
        <img
          src="{{ thumb  | relative_url }}"
          data-full="{{ large | relative_url }}"
          alt="{{ caption }}"
          loading="lazy" decoding="async">
        {% if p.caption %}<figcaption>{{ p.caption }}</figcaption>{% endif %}
      </figure>
    {% endfor %}
  </div>
</article>

{% if page.comments != false %}
<section id="comments" class="comments">
  <h2>Comments</h2>
  <script src="https://giscus.app/client.js"
        data-repo="liilymiao/liilymiao.github.io"
        data-repo-id="R_kgDOQSaSGw"
        data-category="General"
        data-category-id="DIC_kwDOQSaSG84Cxt0Y"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</section>
{% endif %}

<!-- PhotoSwipe 脚本（ESM） -->
<script type="module">
  import PhotoSwipe from 'https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js';

  (() => {
    const grid = document.querySelector('.album-grid');
    if (!grid) return;

    function buildItems() {
      const imgs = Array.from(grid.querySelectorAll('.album-item img'));
      return imgs.map(img => {
        const full = img.getAttribute('data-full') || img.currentSrc || img.src;

        // 用缩略图比例推算一个更大的尺寸，保证进灯箱后能“放大”
        const ratio = (img.naturalWidth && img.naturalHeight)
          ? (img.naturalHeight / img.naturalWidth)
          : (2/3); // 兜底 3:2
        const W = 2000;
        const H = Math.round(W * ratio);

        return { src: full, msrc: img.src, width: W, height: H, alt: img.alt || '' };
      });
    }

    function openLightbox(clickedImg) {
      const items = buildItems();
      const cur = clickedImg.getAttribute('data-full') || clickedImg.currentSrc || clickedImg.src;
      const index = Math.max(0, items.findIndex(it => it.src === cur));

      const pswp = new PhotoSwipe({
        index,
        dataSource: items,
        bgOpacity: 0.95,
        wheelToZoom: true
      });
      pswp.init();
    }

    grid.addEventListener('click', (e) => {
      const img = e.target.closest('.album-item img');
      if (!img) return;
      e.preventDefault();
      openLightbox(img);
    });
  })();
</script>

<style>
  .album-grid{
    columns: 2;
    column-gap:16px;
    margin-top:10px;
  }
  @media (max-width:980px){ .album-grid{ columns:2; } }
  @media (max-width:640px){ .album-grid{ columns:1; } }

  .album-item{
    break-inside:avoid; -webkit-column-break-inside:avoid; margin:0 0 16px;
    background:var(--card-bg);
    border:var(--card-border);
    border-radius:10px; overflow:hidden;
    box-shadow:var(--card-shadow);
  }
  .album-item img{
    display:block; width:100%; height:auto; cursor: zoom-in;
  }
  .album-item figcaption{
    padding:8px 10px;
    color:var(--muted);
    font-size:.92rem;
    background:var(--card-bg);
  }
  /* 评论区简单留个间距 */
  #comments{
    margin-top: 32px;
  }
</style>