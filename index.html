---
layout: default
---

<article class="home">

  <!-- 最新文章 -->
  <section class="home-section">
    <div class="home-section-head">
      <h1 data-i18n="home.latest">Latest posts</h1>
      <a href="{{ '/index.html#posts' | relative_url }}" class="home-viewall" data-i18n="home.viewall">
        View all →
      </a>
    </div>

    {%- assign posts_sorted = site.posts | sort: "date" | reverse -%}
    <div class="home-posts">
      {%- for post in posts_sorted limit:3 -%}
        <a class="home-post-card" href="{{ post.url | relative_url }}">
          <h2 class="home-post-title">
            {{ post.title_en | default: post.title }}
          </h2>
          <p class="home-post-meta">
            {{ post.date | date: "%Y-%m-%d" }}
            {%- if post.categories and post.categories != empty -%}
              · {{ post.categories | join: ", " }}
            {%- endif -%}
          </p>
          {%- if post.excerpt -%}
            <p class="home-post-excerpt">
              {{ post.excerpt | strip_html | strip | truncate: 120 }}
            </p>
          {%- endif -%}
        </a>
      {%- endfor -%}
    </div>
  </section>

  <!-- 关于 -->
  <section class="home-section">
    <div class="home-section-head">
      <h2 data-i18n="home.about">About</h2>
    </div>
    <div class="home-about">
      <p>
        <a href="{{ '/about.html' | relative_url }}">About page →</a>
      </p>
    </div>
  </section>

  <!-- 相册预览 -->
  <section class="home-section">
    <div class="home-section-head">
      <h2 data-i18n="home.albums">Albums</h2>
      <a href="{{ '/albums.html' | relative_url }}" class="home-viewall" data-i18n="home.viewall">
        View all →
      </a>
    </div>

    {%- assign albums = site.pages | where: "layout", "album" | sort: "date" | reverse -%}
    <div class="home-albums-grid">
      {%- for a in albums limit:6 -%}
        <a class="home-album-card" href="{{ a.url | relative_url }}">
          <div class="home-album-cover">
            {%- if a.cover -%}
              <img src="{{ a.cover | relative_url }}"
                   alt="{{ a.title_en | default: a.title }}"
                   loading="lazy" decoding="async">
            {%- else -%}
              <div class="home-album-cover-placeholder"></div>
            {%- endif -%}
          </div>
          <div class="home-album-meta">
            <h3 class="home-album-title">
              {{ a.title_en | default: a.title }}
            </h3>
            <p class="home-album-sub">
              {%- if a.date -%}
                {{ a.date | date: "%Y-%m-%d" }}
              {%- endif -%}
            </p>
          </div>
        </a>
      {%- endfor -%}
    </div>
  </section>

  <!-- Photos 区 -->
  <section class="home-section">
    <div class="home-section-head">
      <h2 data-i18n="home.photos">Photos</h2>
      <a href="{{ '/albums.html' | relative_url }}" class="home-viewall" data-i18n="home.viewall">
        View all →
      </a>
    </div>

    {%- comment -%}
      从所有 album.page 里收集 lens 标签（字符串），再去重 + 排序。
      不对照片做服务端 sort，避免 NilClass 对 String 的比较。
    {%- endcomment -%}

    {%- assign lens_tags = "" | split: "" -%}
    {%- for alb in albums -%}
      {%- if alb.photos -%}
        {%- for p in alb.photos -%}
          {%- if p.lens -%}
            {%- assign lens_str = p.lens | join: ", " -%}
            {%- assign one = lens_str | split: "|||" -%}
            {%- assign lens_tags = lens_tags | concat: one -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
    {%- assign lens_tags = lens_tags | uniq | sort -%}

    <div class="album-filters" id="photoFilters">
      <strong data-i18n="filters.filter">Lens:</strong>
      <button type="button" data-lens="all" class="on" data-i18n="filters.all">All</button>
      {%- for l in lens_tags -%}
        {%- if l != "" -%}
          <button type="button" data-lens="{{ l }}">{{ l }}</button>
        {%- endif -%}
      {%- endfor -%}
    </div>

    <div class="home-photos-grid" id="photoGrid">
      {%- for alb in albums -%}
        {%- if alb.photos -%}
          {%- for p in alb.photos -%}
            {%- assign lens_str = "" -%}
            {%- if p.lens -%}
              {%- assign lens_str = p.lens | join: ", " -%}
            {%- endif -%}

            {%- assign src   = p.src -%}
            {%- assign base  = src | replace:'/assets/img/albums/','/assets/thumbs/albums/' -%}
            {%- assign thumb = base
              | replace: '.JPG','-thumb.jpg'  | replace: '.JPEG','-thumb.jpg'
              | replace: '.jpg','-thumb.jpg'  | replace: '.jpeg','-thumb.jpg' -%}

            <a class="photo-card"
               href="{{ alb.url | relative_url }}"
               data-lens="{{ lens_str }}">
              <div class="photo-thumb">
                <img src="{{ thumb | relative_url }}"
                     alt="{{ alb.title_en | default: alb.title }}"
                     loading="lazy" decoding="async">
              </div>
              <div class="photo-meta">
                <div class="photo-title">
                  {{ alb.title_en | default: alb.title }}
                </div>
                <div class="photo-sub">
                  {%- if p.taken_at -%}
                    <span class="photo-date">{{ p.taken_at }}</span>
                  {%- elsif alb.date -%}
                    <span class="photo-date">{{ alb.date | date: "%Y-%m-%d" }}</span>
                  {%- endif -%}
                  {%- if lens_str != "" -%}
                    {%- if p.taken_at or alb.date -%} · {% endif -%}
                    <span class="photo-lens">{{ lens_str }}</span>
                  {%- endif -%}
                </div>
              </div>
            </a>
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  </section>

</article>

<script>
(function(){
  var filters = document.getElementById('photoFilters');
  var cards   = document.querySelectorAll('.photo-card');
  if (!filters || !cards.length) return;

  filters.addEventListener('click', function(e){
    var btn = e.target.closest('button[data-lens]');
    if (!btn) return;

    var lens = btn.getAttribute('data-lens');
    Array.prototype.forEach.call(
      filters.querySelectorAll('button[data-lens]'),
      function(b){ b.classList.toggle('on', b === btn); }
    );

    Array.prototype.forEach.call(cards, function(card){
      var tag = card.getAttribute('data-lens') || '';
      card.style.display = (lens === 'all' || tag === lens) ? '' : 'none';
    });
  });
})();
</script>

<style>
  .home-section{ margin-bottom:32px; }
  .home-section-head{
    display:flex; align-items:baseline; justify-content:space-between;
    gap:12px; margin-bottom:10px;
  }
  .home-viewall{
    font-size:.9rem; text-decoration:none; color:var(--muted);
  }

  .home-posts{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:16px;
  }
  .home-post-card{
    display:block;
    padding:12px 14px;
    background:var(--card-bg);
    border:var(--card-border);
    border-radius:12px;
    box-shadow:var(--card-shadow);
    text-decoration:none;
    color:inherit;
  }
  .home-post-title{ margin:0 0 4px; font-size:1rem; }
  .home-post-meta{
    margin:0 0 8px;
    font-size:.86rem;
    color:var(--muted);
  }
  .home-post-excerpt{
    margin:0;
    font-size:.9rem;
    color:var(--muted);
  }

  .home-albums-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:16px;
  }
  .home-album-card{
    display:flex; flex-direction:column;
    background:var(--card-bg);
    border:var(--card-border);
    border-radius:12px;
    overflow:hidden;
    box-shadow:var(--card-shadow);
    text-decoration:none;
    color:inherit;
  }
  .home-album-cover img,
  .home-album-cover-placeholder{
    display:block;
    width:100%; height:150px; object-fit:cover;
    background:var(--bg-soft);
  }
  .home-album-meta{ padding:8px 10px 10px; }
  .home-album-title{ margin:0 0 4px; font-size:.98rem; }
  .home-album-sub{ margin:0; font-size:.84rem; color:var(--muted); }

  .album-filters{
    display:flex; flex-wrap:wrap; gap:8px;
    align-items:center; margin-bottom:10px;
  }
  .album-filters strong{ font-size:.9rem; }
  .album-filters button{
    border-radius:999px;
    padding:4px 10px;
    border:1px solid var(--border-subtle);
    background:transparent;
    font-size:.86rem;
    cursor:pointer;
  }
  .album-filters button.on{
    border-width:2px;
  }

  .home-photos-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:14px;
  }
  .photo-card{
    display:flex; flex-direction:column;
    background:var(--card-bg);
    border:var(--card-border);
    border-radius:12px;
    overflow:hidden;
    text-decoration:none;
    color:inherit;
    box-shadow:var(--card-shadow);
  }
  .photo-thumb img{
    display:block; width:100%; height:160px; object-fit:cover;
  }
  .photo-meta{ padding:8px 10px 10px; }
  .photo-title{ font-size:.95rem; margin-bottom:4px; }
  .photo-sub{
    font-size:.82rem;
    color:var(--muted);
  }
</style>