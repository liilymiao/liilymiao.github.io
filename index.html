---
layout: default
title: Home
---

<h1>Latest posts</h1>
<ul>
  {% for post in site.posts %}
    <li>
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
      <small> — {{ post.date | date: "%Y-%m-%d" }}</small>
    </li>
  {% endfor %}
</ul>

<hr>

<section id="about">
  <h2>About</h2>
  {% include about.html %}
  <p><a href="{{ '/about/' | relative_url }}">More →</a></p>
</section>

<hr>

<section id="albums">
  <h2>Albums</h2>

  {%- assign albums_all = site.pages | where: "layout", "album" -%}
  {%- assign locs = albums_all | map: "location" | uniq | sort -%}

  <div class="album-filters" id="albumLocFilters">
    <strong>Location:</strong>
    <button type="button" data-loc="all" class="on">All</button>
    {%- for loc in locs -%}
      {%- assign rep = albums_all | where: "location", loc | first -%}
      <button type="button" data-loc="{{ loc }}">{{ rep.location_name | default: loc }}</button>
    {%- endfor -%}
  </div>

  <div class="albums-grid" id="albumGrid">
    {%- assign cards = albums_all | sort: "date" | reverse -%}
    {%- for a in cards limit:6 -%}
      <a class="album-card"
         href="{{ a.url | relative_url }}"
         data-location="{{ a.location | default: '' }}">
        {%- if a.cover -%}<img src="{{ a.cover | relative_url }}" alt="{{ a.title }}" loading="lazy">{%- endif -%}
        <div class="meta">
          <h3>{{ a.title }}</h3>
          {%- if a.date -%}<small>{{ a.date | date: "%Y-%m-%d" }}</small>{%- endif -%}
        </div>
      </a>
    {%- endfor -%}
  </div>
  <p><a href="{{ '/albums/' | relative_url }}">View all →</a></p>
</section>

<hr style="margin:2rem 0; opacity:.2">

<section id="photos">
  <h2>Photos</h2>

  {%- comment -%} Collect all lens names (supports array or string) {%- endcomment -%}
  {%- assign lens_pool = "" | split: "" -%}
  {%- for a in albums_all -%}
    {%- if a.photos -%}
      {%- for p in a.photos -%}
        {%- if p.lens -%}
          {%- assign L = p.lens -%}
          {%- if L.first -%}
            {%- assign lens_pool = lens_pool | concat: L -%}
          {%- else -%}
            {%- assign L_arr = L | replace: ',', ' ' | split: ' ' | reject: '' -%}
            {%- assign lens_pool = lens_pool | concat: L_arr -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign lenses = lens_pool | uniq | sort -%}

  <div class="album-filters" id="photoFilters">
    <strong>Filter:</strong>
    <button type="button" data-lens="all" class="on">All</button>
    {%- for l in lenses -%}
      <button type="button" data-lens="{{ l }}">{{ l }}</button>
    {%- endfor -%}
  </div>

<div class="photos-grid" id="photoGrid">
  {%- assign photo_items = "" | split: "" -%}
  {%- for a in albums_all -%}
    {%- if a.photos -%}
      {%- for p in a.photos -%}
        {%- assign when = p.taken_at | default: a.date -%}
        {%- assign ts   = when | date: "%s" -%}
        {%- assign item = p | merge: {
              "_album_title": a.title,
              "_album_url":   a.url,
              "_taken_at":    when,
              "_ts":          ts
            } -%}
        {%- assign photo_items = photo_items | push: item -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}

  {%- assign photos_sorted = photo_items | sort: "_ts" | reverse -%}

  {%- comment -%} 开关：把 show_debug 设为 true 可打印前 12 条的排序键 {%- endcomment -%}
  {%- assign show_debug = false -%}
  {%- if show_debug -%}
    <ol style="font:12px ui-monospace,monospace;opacity:.7;margin:.5rem 0 1rem;padding-left:1.2rem">
      {%- for p in photos_sorted limit:12 -%}
        <li>{{ p._taken_at }} → {{ p._ts }}</li>
      {%- endfor -%}
    </ol>
  {%- endif -%}

  {%- for p in photos_sorted -%}
    <a class="photo-card"
       href="{{ p._album_url | relative_url }}"
       data-lenses="{{ p.lens | join: ' ' | default: p.lens | default: '' }}"
       title="{{ p.caption | default: p._album_title }}">
      <img src="{{ p.src | relative_url }}" alt="{{ p.caption | default: p._album_title }}" loading="lazy">
      <div class="ph-meta">
        <small>{{ p._taken_at | date: "%Y-%m-%d" }}</small>
        {%- if p.lens -%}<small> · {{ p.lens | join: ", " | default: p.lens }}</small>{%- endif -%}
      </div>
    </a>
  {%- endfor -%}
</div>

    {%- assign photos_sorted = photo_items | sort: "_ts" | reverse -%}
    {%- for p in photos_sorted -%}
      <a class="photo-card"
         href="{{ p._album_url | relative_url }}"
         data-lenses="{{ p.lens | join: ' ' | default: p.lens | default: '' }}"
         title="{{ p.caption | default: p._album_title }}">
        <img src="{{ p.src | relative_url }}" alt="{{ p.caption | default: p._album_title }}" loading="lazy">
        <div class="ph-meta">
          <small>{{ p._taken_at | date: "%Y-%m-%d" }}</small>
          {%- if p.lens -%}<small> · {{ p.lens | join: ", " | default: p.lens }}</small>{%- endif -%}
        </div>
      </a>
    {%- endfor -%}
  </div>
</section>

<script>
(function () {
  // Albums: filter by location with ?loc=
  const ag = document.getElementById('albumGrid');
  const ab = document.getElementById('albumLocFilters');
  if (ag && ab) {
    const url  = new URL(window.location.href);
    const initial = url.searchParams.get('loc') || 'all';
    const cards = Array.from(ag.querySelectorAll('.album-card'));
    const btns  = Array.from(ab.querySelectorAll('[data-loc]'));

    function setActive(loc){ btns.forEach(b=>b.classList.toggle('on', b.dataset.loc===loc)); }
    function apply(loc){
      cards.forEach(c=>{
        const v = c.getAttribute('data-location') || '';
        c.style.display = (loc==='all' || v===loc) ? '' : 'none';
      });
      const u = new URL(window.location.href);
      if(loc==='all') u.searchParams.delete('loc'); else u.searchParams.set('loc', loc);
      history.replaceState(null,'',u.toString());
    }
    ab.addEventListener('click', e=>{
      const btn = e.target.closest('[data-loc]');
      if(!btn) return;
      const loc = btn.dataset.loc;
      setActive(loc); apply(loc);
    });
    const exists = btns.some(b=>b.dataset.loc===initial);
    const start  = exists ? initial : 'all';
    setActive(start); apply(start);
  }

  // Photos: filter by lens with ?lens=
  const pg = document.getElementById('photoGrid');
  const pb = document.getElementById('photoFilters');
  if (pg && pb) {
    const url  = new URL(window.location.href);
    const initial = url.searchParams.get('lens') || 'all';
    const cards = Array.from(pg.querySelectorAll('.photo-card'));
    const btns  = Array.from(pb.querySelectorAll('[data-lens]'));

    function setActive(l){ btns.forEach(b=>b.classList.toggle('on', b.dataset.lens===l)); }
    function apply(l){
      cards.forEach(c=>{
        const set = (c.getAttribute('data-lenses')||'').split(/\s+/).filter(Boolean);
        c.style.display = (l==='all' || set.includes(l)) ? '' : 'none';
      });
      const u = new URL(window.location.href);
      if(l==='all') u.searchParams.delete('lens'); else u.searchParams.set('lens', l);
      history.replaceState(null,'',u.toString());
    }
    pb.addEventListener('click', e=>{
      const btn = e.target.closest('[data-lens]');
      if(!btn) return;
      const l = btn.dataset.lens;
      setActive(l); apply(l);
    });
    const exists = btns.some(b=>b.dataset.lens===initial);
    const start  = exists ? initial : 'all';
    setActive(start); apply(start);
  }
})();
</script>